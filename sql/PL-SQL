--to add writer to the writer table 
CREATE OR REPLACE FUNCTION GET_WRITER_ID(WRITER_NAME IN VARCHAR2) RETURN NUMBER IS

   W_ID NUMBER;
   CHK NUMBER;
	 
BEGIN
   SELECT COUNT(*) INTO CHK
   FROM WRITER
   WHERE NAME = WRITER_NAME;

   IF CHK > 0 THEN 
      NULL;
   ELSE
      INSERT INTO WRITER(NAME) VALUES (WRITER_NAME);
   END IF;

   SELECT ID INTO W_ID
   FROM WRITER
   WHERE NAME = WRITER_NAME;

   RETURN W_ID;
END;
/

--function to insert book 
CREATE OR REPLACE FUNCTION INSERT_BOOK(B_TITLE IN VARCHAR2, WRITER_NAME IN VARCHAR2, PUBLISHER_NAME IN VARCHAR2, DATE_PUB IN NUMBER, B_GENRE IN VARCHAR2, Q_STOCK IN NUMBER, Q_SOLD IN NUMBER, B_PRICE IN NUMBER, B_LANGUAGE IN VARCHAR2, B_RATING IN NUMBER, B_PAGE IN NUMBER, B_IMAGE IN VARCHAR2) RETURN VARCHAR2 IS 

W_ID NUMBER;
CHK NUMBER;
MESSAGE VARCHAR2(100);

BEGIN

W_ID := GET_WRITER_ID(WRITER_NAME);

	 SELECT COUNT(*) INTO CHK
   FROM PUBLISHER
   WHERE NAME = PUBLISHER_NAME;

   IF CHK > 0 THEN 
      INSERT INTO BOOK(TITLE, WRITER_ID, PUBLISHER, DATE_PUBLISHED, GENRE, QUANTITY_IN_STOCK, QUANTITY_SOLD, PRICE, LANGUAGE, RATING, PAGE, IMAGE) VALUES(B_TITLE, W_ID, PUBLISHER_NAME, DATE_PUB, B_GENRE, Q_STOCK, Q_SOLD, B_PRICE, B_LANGUAGE, B_RATING, B_PAGE, B_IMAGE);
			MESSAGE := 'Insertion Successful!';
			
   ELSE
      MESSAGE := 'Insertion Failed!';
			
   END IF;
	 
	 RETURN MESSAGE;
	 
END;
/
